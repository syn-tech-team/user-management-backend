-- =====================================================
-- Database Setup Script for Distributed Environment
-- =====================================================
-- This script creates the database, tables, and populates data
-- for a distributed user management system
-- =====================================================
-- 1. Create Database
-- =====================================================
drop database if exists userdb20251202;
create database userdb20251202;

-- Use the created database
USE userdb20251202;

-- 2. Create Tables
-- =====================================================

-- Create USERS table (distributed-friendly with UUID primary keys)
CREATE TABLE USERS (
  ID VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
  FIRST_NAME VARCHAR(255) NOT NULL,
  LAST_NAME VARCHAR(255) NOT NULL,
  EMAIL VARCHAR(255) NOT NULL UNIQUE,
  PASSWORD VARCHAR(255) NOT NULL,
  IMAGE VARCHAR(1024),
  CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_email (EMAIL),
  INDEX idx_created_at (CREATED_AT)
);

-- Create ADDRESSES table (distributed-friendly with UUID foreign keys)
CREATE TABLE ADDRESSES (
  ID VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
  USER_ID VARCHAR(36) NOT NULL,
  STREET VARCHAR(255) NOT NULL,
  CITY VARCHAR(100) NOT NULL,
  STATE VARCHAR(100),
  COUNTRY VARCHAR(100) NOT NULL,
  ZIP_CODE VARCHAR(20) NOT NULL,
  TYPE ENUM('HOME', 'OFFICE', 'BILLING', 'SHIPPING') NOT NULL,
  PRIMARY_ADDRESS BOOLEAN DEFAULT FALSE,
  CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  CONSTRAINT FK_ADDRESSES_USERS
    FOREIGN KEY (USER_ID) REFERENCES USERS(ID)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  INDEX idx_user_id (USER_ID),
  INDEX idx_type (TYPE),
  INDEX idx_primary_address (PRIMARY_ADDRESS),
  INDEX idx_created_at (CREATED_AT)
);

-- 3. Populate Sample Data
-- =====================================================

-- Insert sample users with UUID primary keys
INSERT INTO USERS (ID, FIRST_NAME, LAST_NAME, EMAIL, PASSWORD, IMAGE, CREATED_AT, UPDATED_AT)
VALUES
('550e8400-e29b-41d4-a716-446655440000', 'Jane', 'Smith', 'jane.smith@example.com', '$2a$10$xkd0LHAkxMQJqhN8/LewfBPCOYz6TtxMQJqhN8', 'http://s3bucket1975913274917491hfkqhoqwo.aws.com/7439502iheirio', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

INSERT INTO USERS (ID, FIRST_NAME, LAST_NAME, EMAIL, PASSWORD, IMAGE, CREATED_AT, UPDATED_AT)
VALUES
('550e8400-e29b-41d4-a716-446655440001', 'John','Doe', 'john.doe@example.com', '$2a$10$$LQv3c1yqBWVHxkd0L$10$xkd0LH', 'http://s3bucket1975913274917491hfkqhoqwo.aws.com/743asfdsafsa',CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

INSERT INTO USERS (ID, FIRST_NAME, LAST_NAME,EMAIL, PASSWORD, IMAGE, CREATED_AT, UPDATED_AT)
VALUES
('550e8400-e29b-41d4-a716-446655440002', 'Alice','Johnson', 'alice.johnson@example.com', '$2a$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewfBPjJYfQgGpCQ2', 'http://s3bucket1975913274917491hfkqhoqwo.aws.com/7439502asfsaiheirio', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

INSERT INTO USERS (ID, FIRST_NAME, LAST_NAME, EMAIL, PASSWORD, IMAGE, CREATED_AT, UPDATED_AT)
VALUES
('550e8400-e29b-41d4-a716-446655440003', 'Bob', 'Wilson', 'bob.wilson@example.com', '$2a$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewfBPjJYfQgGpCQ2', 'http://s3bucket1975913274917491hfkqhoqwo.aws.com/7439asfdsafasf502iheirio',CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

INSERT INTO USERS (ID, FIRST_NAME, LAST_NAME, EMAIL, PASSWORD, IMAGE, CREATED_AT, UPDATED_AT)
VALUES
('550e8400-e29b-41d4-a716-446655440004', 'Emily','Davis', 'emily.davis@example.com', '$2a$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewfBPjJYfQgGpCQ2', 'http://s3bucket1975913274917491hfkqhoqwo.aws.com/7439502iheiasf14312rio',CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

-- Insert sample addresses linked to users via UUID references
INSERT INTO ADDRESSES (ID, USER_ID, STREET, CITY, STATE, COUNTRY, ZIP_CODE, TYPE, PRIMARY_ADDRESS, CREATED_AT, UPDATED_AT)
VALUES
('660e8400-e29b-41d4-a716-446655440000', '550e8400-e29b-41d4-a716-446655440000', '123 Main St', 'Houston', 'TX', 'US', '77001', 'HOME', TRUE, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

INSERT INTO ADDRESSES (ID, USER_ID, STREET, CITY, STATE, COUNTRY, ZIP_CODE, TYPE, PRIMARY_ADDRESS, CREATED_AT, UPDATED_AT)
VALUES
('660e8400-e29b-41d4-a716-446655440001', '550e8400-e29b-41d4-a716-446655440000', '500 Corporate Dr Floor 2', 'Houston', 'TX', 'US', '77002', 'OFFICE', FALSE, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

INSERT INTO ADDRESSES (ID, USER_ID, STREET, CITY, STATE, COUNTRY, ZIP_CODE, TYPE, PRIMARY_ADDRESS, CREATED_AT, UPDATED_AT)
VALUES
('660e8400-e29b-41d4-a716-446655440002', '550e8400-e29b-41d4-a716-446655440001', '789 Park Ave Suite 300', 'Austin', 'TX', 'US', '73301', 'HOME', TRUE, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

INSERT INTO ADDRESSES (ID, USER_ID, STREET, CITY, STATE, COUNTRY, ZIP_CODE, TYPE, PRIMARY_ADDRESS, CREATED_AT, UPDATED_AT)
VALUES
('660e8400-e29b-41d4-a716-446655440003', '550e8400-e29b-41d4-a716-446655440002', '456 Oak Street', 'Dallas', 'TX', 'US', '75201', 'HOME', TRUE, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

INSERT INTO ADDRESSES (ID, USER_ID, STREET, CITY, STATE, COUNTRY, ZIP_CODE, TYPE, PRIMARY_ADDRESS, CREATED_AT, UPDATED_AT)
VALUES
('660e8400-e29b-41d4-a716-446655440004', '550e8400-e29b-41d4-a716-446655440002', '100 Business Blvd', 'Dallas', 'TX', 'US', '75202', 'OFFICE', FALSE, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

INSERT INTO ADDRESSES (ID, USER_ID, STREET, CITY, STATE, COUNTRY, ZIP_CODE, TYPE, PRIMARY_ADDRESS, CREATED_AT, UPDATED_AT)
VALUES
('660e8400-e29b-41d4-a716-446655440005', '550e8400-e29b-41d4-a716-446655440003', '321 Pine Road', 'San Antonio', 'TX', 'US', '78201', 'HOME', TRUE, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

INSERT INTO ADDRESSES (ID, USER_ID, STREET, CITY, STATE, COUNTRY, ZIP_CODE, TYPE, PRIMARY_ADDRESS, CREATED_AT, UPDATED_AT)
VALUES
('660e8400-e29b-41d4-a716-446655440006', '550e8400-e29b-41d4-a716-446655440004', '555 Elm Street Apt 4B', 'Fort Worth', 'TX', 'US', '76101', 'HOME', TRUE, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

-- END OF SCRIPTS